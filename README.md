# AverageSeeds

## API

Все методы API возвращают данные в формате JSON

### GET /seeds

**Параметры:**

- `subsections` — номера подразделов через запятую. Может отсутствовать или быть пустым, если, например, требуется просто получить количество обновлений БД

**Ответ:**

- ~~`success: Boolean`~~ — удалён из API, так как есть коды ответа
- `message: String` — сообщение, которое следует дополнительно вывести пользователю. Всегда присутствует при ошибке, может присутствовать при успешном запросе и носить информационный характер
- `mainUpdatesCount: Int[]` — массив из 30 элементов, показывающих количество полных обновлений БД в каждый из 30-ти прошедших дней, где `[0]` – вчерашний день, `[1]` – позавчерашний, и т.д. Так как БД обновляется каждый час, в идеальной ситуации каждый из 30 элементов должен быть равен `24`
- `subsections: Map<Int, Map<Int, Topic>>` — ассоциативный массив, где ключом является номер подраздела, а значением — другой ассоциативный массив, где ключом является номер темы, а значением — объект `Topic`
- `Topic: Object` — объект, содержащий информацию о теме. В самом ответе названия не имеет. Содержит следующие поля:
   - `u: Int[]` – массив из 30 элементов, показывающих количество обновлений темы, по аналогии с `mainUpdatesCount`. Данное поле может отсутствовать, что означает, что тема обновлялась столько же раз, сколько и БД, и для расчёта сидов в таком случае следует использовать `mainUpdatesCount`
   - `s: Int[]` — массив из 30 элементов, показывающих сумму сидов в каждый из 30-ти дней. Получение среднего количества сидов осуществляется делением суммы сидов в этот день на количество обновлений в этот день. Данное действие должен выполнять уже сам клиент. Если в этот день 0 обновлений, то количество сидов не определено

**Пример ответа:**
```
{
    "message": "Курить вредно, если что",
    "mainUpdatesCount": [20,24,24,24,24,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    "subsections":{
        "1":{
            "1001":{
                "s":[63,94,113,93,96,63,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
            },
            "1003":{
                "s":[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                "u":[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
            }
        },
        "2":{}
    }
}
```

### GET /currentDay

**Параметры:**

нет

**Ответ:**

- ~~`success: Boolean`~~ — удалён из API, так как есть коды ответа
- `message: String` — сообщение, которое следует дополнительно вывести пользователю. Всегда присутствует при ошибке, может присутствовать при успешном запросе и носить информационный характер
- `currentDay: Int` — номер текущего дня из 31-дневного цикла БД. Принимает значения от 0 до 30. Дни считаются по московскому времени, во избежание путаницы

### GET /version

**Параметры:**

нет

**Ответ:**

- `version: Int` — номер версии. Имеет вид "<мажор>.<минор>.<патч>[-снапшот]"

### Ограничения и известные проблемы
- **Нельзя получить сиды на текущий день.** Это сделано намеренно, так как сиды считаются именно по дням, а не по часам, соответственно виды за текущий день могут быть собраны только в конце дня
- **Нельзя установить количество дней для запроса.** Также сделано намеренно, дабы клиент запросил сиды один раз, сохранил их в свою БД, и больше не возвращался до следующего дня
- **Нет ограничений на запрос.** ~~Ограничением отсутствие ограничения является в том плане, что попытка запросить огромное количество подразделов сразу может уронить сервер.~~ Клиент может запросить сколько угодно данных, если готов ожидать их получения и готов их принять
- **Не ведётся учёт дня в постоянной памяти.** Потенциально это может привести к тому, что при перезапуске сервиса на стыке дней новые данные будут добавляться к старым, вместо того, чтобы заменить их. Так как пока нет полных данных за 30 дней, эта проблема не может проявиться и будет решена к моменту накопления полных данных

### Тестовый контур
Тестовая база доступна по адресу https://seeds-test.huku.one/. Она также собирает сиды, но работает отдельно от основной, так что не страшно, если она упадёт
